---
title: "Go è¨€èªã‚’å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§å§‹ã‚ã¦ã¿ã‚‹ 2 (Tutorial: Create a module)"
emoji: "ğŸ”°"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Go]
published: true
---

## è¨˜äº‹æ¦‚è¦

Goå…¥é–€è€…ãŒå…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã®[Tutorial: Create a module](https://go.dev/doc/tutorial/create-module)ã‚’å®Ÿæ–½ã—ãŸæ™‚ã®æ‰‹é †ã¨  
èª¿ã¹ãŸã“ã¨ã‚’å‚™å¿˜éŒ²ã¨ã—ã¦æ®‹ã—ãŸã‚‚ã®ã§ã™ã€‚  

[Go è¨€èªã‚’å…¬å¼ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã§å§‹ã‚ã¦ã¿ã‚‹ 1 (Tutorial: Get started with Go)](https://zenn.dev/harusame0616/articles/9d2474a3e4128a)ã®ç¶šãã§ã™ã€‚

ãƒªãƒã‚¸ãƒˆãƒªã¯ã“ã¡ã‚‰  
https://github.com/harusame0616/go-lang-official-tutorial

--- 

## æŒ¨æ‹¶ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ

æŒ¨æ‹¶ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç”¨ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã¨ç§»å‹•ã€‚
```bash
> mkdir greetings && cd greeetings
```

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åˆæœŸåŒ–
```bash
> go mod init example.com/greetings
```

greetings.goä½œæˆ
```go
package greetings

import "fmt"

func Hello(name string) string {
	message := fmt.Sprintf("Hi, %v. Welcome!", name)
	return message
}
```

- å¤§æ–‡å­—ã§å§‹ã¾ã‚‹é–¢æ•°ã¯ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã•ã‚Œã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å¤–éƒ¨ã‹ã‚‰å‘¼ã³å‡ºã›ã‚‹é–¢æ•°ã¨ãªã‚‹ã€‚
- `:=` ã¯å¤‰æ•°ã®å®šç¾©ã¨åˆæœŸåŒ–ã‚’åŒæ™‚ã«ã™ã‚‹ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã€‚
    - å¤‰æ•°ã‚’å®šç¾©ã™ã‚‹å ´åˆã¯æ˜ç¤ºçš„ã«å‹ã‚’æŒ‡å®šã—ã¦å®£è¨€ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŒã€`:=` ã‚’ä½¿ã†ã“ã¨ã§ä»£å…¥å€¤ã«ã‚ˆã£ã¦å‹ã‚’æ¨è«–ã—ã¦ãã‚Œã‚‹ã€‚  
      é€šå¸¸ã®å¤‰æ•°å®šç¾©
      ```go
        var number int
        number = 5
      ```

      :=ã«ã‚ˆã‚‹å¤‰æ•°å®šç¾©
      ```go
        number := 5
      ```

---

## ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä½œæˆ

ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€ä½œæˆã¨ç§»å‹•ã€‚
```bash
> cd .. && mkdir hello && cd hello
```

ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®åˆæœŸåŒ–ã€‚
```bash
> go mod init example.com/hello
```

hello.goã®ä½œæˆ
```go
package main

import (
    "fmt"

    "example.com/greetings"
)

func main() {
    message := greetings.Hello("Gladys")
    fmt.Println(message)
}
```

---

## ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ

æŒ¨æ‹¶ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¯å®Ÿéš›ã«å…¬é–‹ã—ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€ãã®ã¾ã¾ã§ã¯`example.com/greetings` ã®ä¾å­˜é–¢ä¿‚ã‚’è§£æ±ºã§ããªã„ã€‚  
`example.com/greetings` ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã®æŒ¨æ‹¶ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å‚ç…§ã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã€‚
```bash
> go mod edit -replace example.com/greetings=../greetings
```

ä¾å­˜é–¢ä¿‚æ›´æ–°

```bash
> go mod tidy
```


ãƒ¡ã‚¤ãƒ³ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œ
```bash
> go run .
Hi, Gladys. Welcome!
```

ç„¡äº‹è¡¨ç¤ºã•ã‚Œã¾ã—ãŸï¼

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

greetrings.go ã«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã€‚

```go
package greetings

import (
    "errors"
    "fmt"
)

func Hello(name string)(string, error) {
    if name == "" {
        return "", errors.New("empty name")
    }

    message := fmt.Sprintf("Hi, %v. Welcome!", name)
    return message, nil
}
```
- é–¢æ•°ã¯è¤‡æ•°ã®å€¤ã‚’è¿”ã™ã“ã¨ãŒã§ãã‚‹ã€‚
- try/catch/throwãŒãªã„ã®ã§ã€é–¢æ•°ã®æˆ»ã‚Šå€¤ã§ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã®ãŒä¸€èˆ¬çš„ã€‚
- å¤§åŸŸè„±å‡ºãŒã—ãŸã„å ´åˆã¯ defer/recover/panic ãªã©ã‚’ä½¿ã£ã¦å®Ÿç¾ã§ãã‚‹ãŒã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è·¨ãã®ã¯éæ¨å¥¨ã€‚
    - å‚è€ƒ
      - https://blog.amedama.jp/entry/2015/10/11/123535
      - https://github.com/golang/go/wiki/PanicAndRecover#usage-in-a-package


hello.goã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã‚ˆã†ã«å¤‰æ›´ã™ã‚‹ã®ã¨ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã®å‡¦ç†ã‚’è¿½åŠ ã™ã‚‹ã€‚
```go
package main

import (
	"fmt"
	"log"

	"example.com/greetings"
)

func main() {
	log.SetPrefix("greetings: ")
	log.SetFlags(0)

	message, error := greetings.Hello("")
	if error != nil {
		log.Fatal(error)
	}

	fmt.Println(message)
}
```

- log.SetFlagsã§ãƒ­ã‚°å‡ºåŠ›ã™ã‚‹å†…å®¹ã‚’å¤‰æ›´ã§ãã‚‹ã€‚
  - eg. ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»è¡Œç•ªå·(Log.Lshortfile)ã¨ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³(Log.Ldate)ã‚’æŒ‡å®šã™ã‚‹ã€‚
    `log.SetFlags(log.Lshortfile | log.Ldate)` 
  - https://pkg.go.dev/log#pkg-constants
- log.Fatal ã¯ãƒ­ã‚°ã‚’å‡ºåŠ›ã—ã¦ exit status 1 (ç•°å¸¸çµ‚äº†)ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’çµ‚äº†ã™ã‚‹ã€‚
    - [https://pkg.go.dev/log#Fatal](https://pkg.go.dev/log#Fatal)
    
---

## å‹•çš„ãªé…åˆ—(slice)ã‚’ä½¿ã£ã¦å®šç¾©æ¸ˆã¿ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™

greetings.goã®Helloã§ãƒ©ãƒ³ãƒ€ãƒ ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã‚ˆã†ã«å¤‰æ›´ã€‚

```bash
package greetings

import (
	"errors"
	"fmt"
	"math/rand"
	"time"
)

func Hello(name string) (string, error) {
	if name == "" {
		return "", errors.New("empty name")
	}

	message := fmt.Sprintf(randomFormat(), name)
	return message, nil
}

func init() {
	rand.Seed(time.Now().UnixNano())
}

func randomFormat() string {
	formats := []string{
		"Hi, %v. Welcome",
		"Great to see you, %v!",
		"Hail, %v! Well met!",
	}

	return formats[rand.Intn(len(formats))]
}
```

- randomFormatã¯å°æ–‡å­—ã‹ã‚‰å§‹ã¾ã‚‹ã®ã§å¤–éƒ¨ã«å…¬é–‹ã•ã‚Œãªã„(ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã‚¹ã‚³ãƒ¼ãƒ—)
- inité–¢æ•°ã¯ãƒ—ãƒ­ã‚°ãƒ©ãƒ èµ·å‹•æ™‚ã«è‡ªå‹•ã§å‘¼ã³å‡ºã•ã‚Œã‚‹ã€‚
    - [https://go.dev/doc/effective_go#init](https://go.dev/doc/effective_go#init)
- é…åˆ—ã¯è¦ç´ æ•°ãŒå›ºå®šã®å‹ã§ã‚µã‚¤ã‚ºã®å¤‰æ›´ã¯ã§ããªã„ã€‚
    ```go
    var numbers [5]int
    numbers = append(numbers, 9) // ã‚¨ãƒ©ãƒ¼
    ```
    
- ã‚¹ãƒ©ã‚¤ã‚¹ã§ã¯é…åˆ—ã®ã‚µã‚¤ã‚ºã‚’å‹•çš„å¤‰æ›´ã§ãã‚‹ã€‚
    ```go
    var numbers []int
    numbers = append(numbers, 9) // OK
    ```

---

## Mapã‚’ä½¿ã£ã¦è¤‡æ•°äººã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã€‚

è¤‡æ•°ã®åå‰ã‚’å–å¾—ã—ã¦åå‰ã”ã¨ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œæˆã™ã‚‹Hellosé–¢æ•°ã‚’ä½œæˆã™ã‚‹ã€‚

```go
package greetings

import (
	"errors"
	"fmt"
	"math/rand"
	"time"
)

func Hello(name string) (string, error) {
	if name == "" {
		return "", errors.New("empty name")
	}

	message := fmt.Sprintf(randomFormat(), name)
	return message, nil
}

func Hellos(names []string) (map[string]string, error) {
	messages := make(map[string]string)

	for _, name := range names {
		message, err := Hello(name)
		if err != nil {
			return nil, err
		}

		messages[name] = message
	}

	return messages, nil
}

func init() {
	rand.Seed(time.Now().UnixNano())
}

func randomFormat() string {
	formats := []string{
		"Hi, %v. Welcome",
		"Great to see you, %v!",
		"Hail, %v! Well met!",
	}

	return formats[rand.Intn(len(formats))]
}
```

- é…åˆ—ã®è¦ç´ åˆ†ãƒ«ãƒ¼ãƒ—ã™ã‚‹ã«ã¯ for â€¦ range æ§‹æ–‡ã‚’ä½¿ã†
- _(ç©ºç™½è­˜åˆ¥å­) ã¯ä½¿ã‚ãªã„æˆ»ã‚Šå€¤ã‚’å®‰å…¨ã«ç ´æ£„ã™ã‚‹ãŸã‚ã«ä½¿ã†ã€‚
    - æœªä½¿ç”¨ã®å¤‰æ•°ã‚„ã‚¤ãƒ³ãƒãƒ¼ãƒˆã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼æŠ‘æ­¢ã€‚
    - [https://go.dev/doc/effective_go#blank](https://go.dev/doc/effective_go#blank)
- make ã¯æŒ‡å®šã—ãŸå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰²ã‚Šå½“ã¦åˆæœŸåŒ–ã™ã‚‹ã€‚
    - newã¯ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚’è¿”ã—ã€makeã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Ÿæ…‹ã‚’è¿”ã™é•ã„ãŒã‚ã‚‹ã€‚
    - [https://pkg.go.dev/builtin#make](https://pkg.go.dev/builtin#make)

--- 

## ã¿ã‚“ãªå¤§å¥½ããƒ†ã‚¹ãƒˆ

æŒ¨æ‹¶ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ greetings_test.go ã‚’ä½œæˆã™ã‚‹

```go
package greetings

import (
	"regexp"
	"testing"
)

func TestHelloName(t *testing.T) {
	name := "Gladys"
	want := regexp.MustCompile(`\b` + name + `\b`)
	msg, err := Hello("Gladys")
	if !want.MatchString(msg) || err != nil {
		t.Fatalf(`Hello("Gladys") = %q, %v, want match for %#q, nil`, msg, err, want)
	}
}

func TestHelloEmpty(t *testing.T) {
	msg, err := Hello("")
	if msg != "" || err == nil {
		t.Fatalf(`Hello("") = %q, %v, want "", error`, msg, err)
	}
}
```

- testing ã¯ goæ¨™æº–ã®ãƒ†ã‚¹ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€‚
- _test.goã§çµ‚ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ†ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èªè­˜ã™ã‚‹ã€‚
- ãƒ†ã‚¹ãƒˆåã¯ Test[Name] ã®å½¢å¼ã§ã¤ã‘ã‚‹ã€‚
- ãƒ†ã‚¹ãƒˆãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¸ã®ãƒã‚¤ãƒ³ã‚¿ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦å—ã‘å–ã‚‹ã€‚

ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã™ã‚‹

```bash
> go test
PASS
ok      example.com/greetings   0.002s
```

- _test.goã§çµ‚ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®TestNameå½¢å¼ã®é–¢æ•°ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã€‚
- -v ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§è©³ç´°è¡¨ç¤º

---

## ãƒ“ãƒ«ãƒ‰ & ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ“ãƒ«ãƒ‰æ™‚ã—ã¦å®Ÿè¡Œ
```bash
> go build
> ./hello
map[Darrin:Hi, Darrin. Welcome Gladys:Hail, Gladys! Well met! Samantha:Hail, Samantha! Well met!]
```

- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ä¾å­˜é–¢ä¿‚ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã—ãªã„ã€‚
    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¾ã§ã™ã‚‹å ´åˆã¯ `go install`
    - ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«(_test.go)ã§çµ‚ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç„¡è¦–ã™ã‚‹ã€‚
    - [https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies](https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies)



ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦å®Ÿè¡Œ
```bash
> go install
> cd ~/ && hello # ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã®ã§ä»–ã®ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ã§ã‚‚å‘¼ã³å‡ºã›ã‚‹
map[Darrin:Hi, Darrin. Welcome Gladys:Hail, Gladys! Well met! Samantha:Hail, Samantha! Well met!]
```

- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã¨ä¾å­˜é–¢ä¿‚ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¾ã§è¡Œã†ã€‚
    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ `go list -f '{{.Target}}â€™`
    - [https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies](https://pkg.go.dev/cmd/go#hdr-Compile_packages_and_dependencies)

---

ä»¥ä¸Šã§ `Tutorial: Create a module` ã¯çµ‚ã‚ã‚Šã¨ãªã‚Šã¾ã™ã€‚
ãŠèª­ã¿ã„ãŸã ã„ã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

ãŠæ°—ã¥ãã®ç‚¹ç­‰ã‚ã‚Šã¾ã—ãŸã‚‰ã‚³ãƒ¡ãƒ³ãƒˆãŠé¡˜ã„ã—ã¾ã™ã€‚