---
title: "Nuxt3 ã§ãƒšãƒ¼ã‚¸å˜ä½ã®çµåˆãƒ†ã‚¹ãƒˆã‚’ã—ã¦ã¿ãŸ(@nuxt/test-utils + MSW)"
emoji: "ğŸ§ª"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["nuxt3"]
published: true
---

Nuxt3 ã§ @nuxt/test-utils ã¨ MSW ã‚’ä½¿ã£ãŸãƒšãƒ¼ã‚¸å˜ä½ã®çµåˆãƒ†ã‚¹ãƒˆã‚’è©¦ã—ã¦ã¿ãŸã®ã§æ‰‹é †ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚
https://github.com/harusame0616/nuxt3-page-integration-test

## ç’°å¢ƒ

| ç”¨é€”               | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å                   | ãƒãƒ¼ã‚¸ãƒ§ãƒ³      |
| ------------------ | ------------------------------ | --------------- |
| Web ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ | Nuxt                           | 3.5.0           |
| ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼     | vitest                         | 0.31.1          |
| ãƒ†ã‚¹ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª   | @nuxt/test-utils<br>Playwright | 3.5.1<br>1.34.3 |
| ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ¢ãƒƒã‚¯ | MSW                            | 1.2.1           |

@nuxt/test-utils ã¯ Nuxt å‘ã‘ã®ãƒ†ã‚¹ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚
ãƒšãƒ¼ã‚¸å˜ä½ã§ SSR ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆã‚„ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é€šã—ãŸã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãŒè¡Œãªãˆã¾ã™ã€‚
ä¸»ã« E2E ã‚„ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚’ãƒ¢ãƒƒã‚¯ã—ãŸãƒšãƒ¼ã‚¸å˜ä½ã®çµåˆãƒ†ã‚¹ãƒˆå‘ã‘ã§ã™ã€‚

ãªãŠã€2023/05/30 æ—¥ç¾åœ¨ @nuxt/test-utils ã¯é–‹ç™ºä¸­ã§ã‚ã‚Šã€API ã‚„ä»•æ§˜ãŒå¤§ããå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ç‰¹ã«ãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆã¯ Nuxt3 å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å–ã‚Šçµ„ã¿ä¸­ã¨ã ã‘è¨˜è¼‰ã•ã‚Œã¦ã„ã¦ã„ã‚‹ãŸã‚ã”æ³¨æ„ãã ã•ã„ã€‚

- [Nuxt3 testing](https://nuxt.com/docs/getting-started/testing)
- [@nuxt/utils(æ—§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ?)](https://test-utils.nuxtjs.org/)
  â€» API åãªã©å¤‰ã‚ã£ã¦ã„ã‚‹ãŸã‚å‚è€ƒç¨‹åº¦ã«

## æ‰‹é †

### Nuxt ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

```sh
npm nuxi init [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå] && cd [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå]
yarn
```

### ãƒ†ã‚¹ãƒˆç’°å¢ƒæº–å‚™

#### ãƒ†ã‚¹ãƒˆç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

@nuxt/test-utils ã¯ãƒ†ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã¨ã—ã¦ jest / vitest ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚
ã¾ãŸãƒ–ãƒ©ã‚¦ã‚¶ãƒ†ã‚¹ãƒˆã§å†…éƒ¨çš„ã« Playwright ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§åˆã‚ã›ã¦ Playwright ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
yarn add -D vitest @nuxt/test-utils playwright
```

#### vitest è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ã‚¤ãƒ³ãƒãƒ¼ãƒˆã›ãšã« vitest ã®é–¢æ•°ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã« globals è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts:vitest.config.ts
import { defineConfig } from "vitest/config";

export default defineConfig({
  test: {
    globals: true,
  },
});
```

#### TypeScript ç”¨ã« vitest ã®å‹ã‚’è¨­å®š

globals ã‚’æœ‰åŠ¹ã«ã—ãŸå ´åˆã¯åˆã‚ã›ã¦ TypeScript å‘ã‘ã®å‹å®šç¾©ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```json:tsconfig.json
{
  // https://nuxt.com/docs/guide/concepts/typescript
  "extends": "./.nuxt/tsconfig.json",
  "compilerOptions": {
    "types": ["vitest/globals"]
  }
}
```

### MSW æº–å‚™

#### MSW ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

timers ã¯ ãƒ†ã‚¹ãƒˆæ™‚ã«ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãŸã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ã¾ã™ã€‚  
https://github.com/mswjs/msw/discussions/1440

```sh
yarn add -D msw timers
```

#### ãƒ¢ãƒƒã‚¯ç”¨ã®å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

ä¸€æ—¦ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ä½œæˆã—ã€ ã‚ã¨ã§ãƒ¢ãƒƒã‚¯ã®å®šç¾©ã‚’è¿½åŠ ã—ã¦ã„ãã¾ã™ã€‚

```ts:mocks:handlers/index.ts
export const handlers = [];
```

#### CSR ç”¨ã®ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

--save ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§ package.json ã«ã‚µãƒ¼ãƒ“ã‚¹ãƒ¯ãƒ¼ã‚«ãƒ¼ã®ä¿å­˜ãƒ‘ã‚¹ã‚’è¨˜éŒ²ã—ã¦ã€æ›´æ–°ãŒã‚ã£ãŸå ´åˆã«è¿½è·¡ã§ãã‚‹ã‚ˆã†ã—ã¦ã„ã¾ã™ã€‚

```sh
npx msw init public/ --save
```

#### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ç”¨ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ

SSR ç”¨

```ts:mocks/server.ts
import { setupServer } from "msw/node";
import { handlers } from "./handlers";

export const server = setupServer(...handlers);
```

CSR ç”¨

```ts:mocks/browser.ts
import { setupWorker } from "msw";
import { handlers } from "./handlers";

export const worker = setupWorker(...handlers);
```

#### Nuxt ã® MSW ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œæˆ

SSR ã‹ CSR ã‹ã‚’åˆ¤å®šã—ã¦ãƒ¢ãƒƒã‚¯ã‚’èµ·å‹•ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚  
CSR æ™‚ã« ~mocks/server ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã†ã®ã§ defineNuxtPlugin ã®ä¸­ã§å‹•çš„ã« import ã—ã¦ã„ã¾ã™ã€‚

```ts:plugins/msw.ts
// ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ãŸã‚ defineNuxtPlugin ã®ä¸­ã§å‹•çš„ã« import ã—ã¦ã„ã‚‹
// import { worker } from '~/mocks/browser'
// import { server } from '~/mocks/server'

export default defineNuxtPlugin(async () => {
  const { public: isApiMocked } = useRuntimeConfig();
  if (!isApiMocked) {
    return;
  }

  if (process.client) {
    const { worker } = await import("~/mocks/browser");
    await worker.start();
  } else {
    const { server } = await import("~/mocks/server");
    server.listen();
  }
});
```

### ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ

ä»Šå›ã¯ä»¥ä¸‹ã®æ©Ÿèƒ½ã‚’æŒã£ãŸç°¡å˜ãª ToDo ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã™ã€‚

- ToDo ã®ä¸€è¦§å–å¾—
- ToDo ã®ä½œæˆ
- ToDo ã®å®Œäº†/æœªå®Œäº†ã®åˆ‡ã‚Šæ›¿ãˆ

#### API URL ç”Ÿæˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ä½œæˆ

endpoint('/todos') ã¨ã„ã£ãŸå½¢ã§å‘¼ã³å‡ºã™ã¨ãƒ™ãƒ¼ã‚¹ URL ã¨å¼•æ•°ã‚’çµåˆã—ã¦ API ã® URL ã‚’è¿”ã™ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚’ä½œæˆã—ã¾ã™ã€‚
ãƒ¢ãƒƒã‚¯å®šç¾©ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

```ts:utils/api.ts
let _baseUrl = "";

export const setBaseURL = (baseUrl: string) => (_baseUrl = baseUrl);
export const endpoint = (path: string) => new URL(path, _baseUrl).toString();
```

ä¸Šè¨˜ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®ãƒ™ãƒ¼ã‚¹ URL ã‚’è¨­å®šã™ã‚‹ãŸã‚ã® Nuxt ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½œæˆã—ã¾ã™ã€‚

```ts:plugins/1_endpoint.ts
export default defineNuxtPlugin(() => {
  const {
    public: { baseUrl },
  } = useRuntimeConfig();

  setBaseURL(baseUrl);
});
```

baseUrl ã‚’ runtimeConfig ã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ã« nuxt.config ã« baseUrl ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```ts:nuxt.config.ts
// https://nuxt.com/docs/api/configuration/nuxt-config

export default defineNuxtConfig({
  runtimeConfig: {
    public: {
      baseUrl: "http://localhost:3000/api",
    },
  },
});
```

#### ToDo ã®å‹ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

API ãŒè¿”ã™ ToDo ã®å‹ã‚’å®šç¾©ã—ã¾ã™ã€‚

```ts:types/todo.ts
export type TodoDto = {
  id: string;
  title: string;
  finishedAt: Date | null;
};
```

#### UUID ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã® ID ã¨ã—ã¦ UUID ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
yarn add -D uuid @types/uuid
```

#### API ã® ãƒ¢ãƒƒã‚¯å®šç¾©è¿½åŠ 

ä»¥ä¸‹ã® API ã®ãƒ¢ãƒƒã‚¯ã‚’å®šç¾©ã—ã¾ã™ã€‚

- GET /todos : Todo ã®ä¸€è¦§å–å¾—
- POST /todos : Todo ã®ä½œæˆ
- PUT /todos/is_finished : Todo ã®å®Œäº†ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å¤‰æ›´

ã¾ãŸåˆæœŸãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦é©å½“ãª Todo ã‚’ inmemory ã§ä¿æŒã—ã¦ã„ã¾ã™ã€‚
ãªãŠã€åˆæœŸãƒ‡ãƒ¼ã‚¿ã® ID ã‚’ UUID ã§å‹•çš„ã«ç”Ÿæˆã—ã¦ã—ã¾ã†ã¨ã€SSR æ™‚ã¨ CSR æ™‚ã§
ID ãŒå¤‰ã‚ã£ã¦ã—ã¾ã†ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```ts:mocks/handlers.ts
import { rest } from "msw";
import { v4 as uuid } from "uuid";
import { TodoDto } from "~/types/todo";

const todoStore: TodoDto[] = [
  {
    id: "c6ca9c61-0a56-4545-8952-b9035f482d7d",
    title: "todo1",
    finishedAt: new Date('2023-05-03'),
  },
  {
    id: "92f8c99d-e42c-4a95-9ae4-2dab2f44e974",
    title: "todo2",
    finishedAt: null,
  },
  {
    id: "0b75e34d-1b3a-4563-bf30-38aceee37d66",
    title: "todo3",
    finishedAt: null,
  },
];

export const handlers = [
  rest.get(endpoint("/todos"), async (req, res, ctx) => {
    return res(
      ctx.status(200),
      ctx.json({
        count: todoStore.length,
        items: [...todoStore],
      })
    );
  }),
  rest.post(endpoint("/todos"), async (req, res, ctx) => {
    const { title } = await req.json();

    if (title.length < 0) {
      throw new Error("title is required");
    }
    const id = uuid();
    todoStore.push({ id, title, finishedAt: null });

    return res(
      ctx.status(200),
      ctx.json({
        id,
      })
    );
  }),
  rest.put(endpoint("/todos/is_finished"), async (req, res, ctx) => {
    const [id, isFinished] = ["id", "isFinished"].map((queryName) =>
      req.url.searchParams.get(queryName)
    );

    const todo = todoStore.find((todo) => todo.id === id);
    if (!todo) {
      throw new Error("todo not found");
    }

    todo.finishedAt = isFinished === "true" ? new Date() : null;

    return res(ctx.status(200));
  }),
];
```

#### ToDo ãƒªã‚¹ãƒˆã®ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«ä½œæˆ

```ts:composables/useTodoList.ts
import { TodoDto } from "~/types/todo";

export const useTodoList = async () => {
  const { data, refresh, ...fetchResult } = await useLazyFetch<{
    count: number;
    items: TodoDto[];
  }>(endpoint("/todos"));

  const addTodo = async (title: string) => {
    await $fetch(endpoint("/todos"), {
      method: "POST",
      body: {
        title,
      },
    });
    await refresh();
  };

  const callChangeIsFinished = async (id: string, isFinished: boolean) => {
    await $fetch(endpoint("/todos/is_finished"), {
      method: "PUT",
      params: {
        id,
        isFinished,
      },
    });
    await refresh();
  };

  const openTodo = (id: string) => callChangeIsFinished(id, false);
  const finishTodo = (id: string) => callChangeIsFinished(id, true);

  return {
    todoList: computed(() => data.value?.items ?? []),
    count: computed(() => data.value?.count ?? 0),
    ...fetchResult,
    addTodo,
    openTodo,
    finishTodo,
  };
};
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

æœ€åˆã« setup ã§ Nuxt ã®ç’°å¢ƒã‚’èµ·å‹•ã—ã¾ã™ã€‚
setup å¾Œã¯ $fetch ã‚„ createPage ã‚’ä½¿ã£ã¦ãƒšãƒ¼ã‚¸å˜ä½ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

\$fetch(url) ã‚’ä½¿ã†ã¨å¯¾è±¡ã®ãƒšãƒ¼ã‚¸ã® SSR ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœ HTML ã‚’ string ã§å–å¾—ã§ãã¾ã™ã€‚

createPage(url) ã‚’ä½¿ã†ã¨å¯¾è±¡ã®ãƒšãƒ¼ã‚¸ã® Page ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
ã“ã® Page ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã¯ Playwright ã® [Page ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹](https://playwright.dev/docs/api/class-page)ãªã®ã§
Playwright ã® API ã‚’ä½¿ã£ã¦è¦ç´ ã®å–å¾—ã‚„ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

ãªãŠã€åˆå›æç”»ã‚‚ createPage ã§ã‚‚ã§ãã‚‹ã¨æ€ã†ã®ã§ã™ãŒä½¿ã„åˆ†ã‘ã‚„ãƒ¡ãƒªãƒƒãƒˆãƒ»ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¯ã‚ˆãã‚ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚

```ts:app.spec.ts
import { createPage, setup, $fetch } from "@nuxt/test-utils";
// import { expect } from "@playwright/test";

const wait = async (f: () => Promise<boolean>) => {
  while (await f()) {
    new Promise((r) => setTimeout(r, 100));
  }
};

describe("todos/index", async () => {
  await setup({
    server: true,
  });

  it("SSR ã§å¿…è¦ãªè¦ç´ ãŒæç”»ã•ã‚Œã¦ã„ã‚‹", async () => {
    const html = await $fetch("/");
    console.error(html);

    // ã‚¿ã‚¤ãƒˆãƒ«
    expect(html).toContain("Todo List");
    // è¿½åŠ ãƒœã‚¿ãƒ³
    expect(html).toContain("Add");
    // åˆæœŸãƒ‡ãƒ¼ã‚¿ã® todo
    expect(html).toContain("todo1");
    expect(html).toContain("todo2");
    expect(html).toContain("todo3");
  });

  it("Todoãƒªã‚¹ãƒˆã®è¿½åŠ ", async () => {
    const page = await createPage("/");

    const titleTextbox = page.getByRole("textbox", { name: "ToDoã‚¿ã‚¤ãƒˆãƒ«" });
    // ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã®åˆæœŸçŠ¶æ…‹ã¯ç©º
    expect(await titleTextbox.inputValue()).toBe("");

    // ã‚¿ã‚¤ãƒˆãƒ«ãŒæœªè¨˜å…¥ã®å ´åˆã¯è¿½åŠ ãƒœã‚¿ãƒ³ã¯ç„¡åŠ¹
    page.getByRole("button", { name: "Add", disabled: true });

    const todoTitle = "ç‰›ä¹³ã‚’è²·ã„ã«è¡Œã";
    await titleTextbox.click();
    await page.keyboard.type(todoTitle);

    await page.getByRole("button", { name: "Add" }).click();

    // todo ãŒåæ˜ ã•ã‚Œã‚‹ã¾ã§å¾…ã¤
    // waitForResponse ã‚’ä½¿ã†ã¨å†…éƒ¨çŸ¥è­˜(APIã®URLã‚„APIã‚’å‘¼ã¶ã“ã¨)ã‚’çŸ¥ã£ã¦ã—ã¾ã†ãŸã‚é¿ã‘ãŸ
    await wait(
      async () =>
        (await page
          .getByRole("listitem")
          .filter({ hasText: todoTitle })
          .count()) === 0
    );

    // todo ãŒãƒªã‚¹ãƒˆã®æœ€å¾Œã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(await page.getByRole("listitem").last().innerText()).toContain(
      todoTitle
    );

    // Todo è¿½åŠ å¾Œã«ã¯ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ãŒç©ºã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(
      await page.getByRole("textbox", { name: "ToDoã‚¿ã‚¤ãƒˆãƒ«" }).inputValue()
    ).toBe("");
  });

  it("Todoãƒªã‚¹ãƒˆã®è¿½åŠ ", async () => {
    const page = await createPage("/");

    const titleTextbox = page.getByRole("textbox", { name: "ToDoã‚¿ã‚¤ãƒˆãƒ«" });
    // ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã®åˆæœŸçŠ¶æ…‹ã¯ç©º
    expect(await titleTextbox.inputValue()).toBe("");

    // ã‚¿ã‚¤ãƒˆãƒ«ãŒæœªè¨˜å…¥ã®å ´åˆã¯è¿½åŠ ãƒœã‚¿ãƒ³ã¯ç„¡åŠ¹
    page.getByRole("button", { name: "Add", disabled: true });

    const todoTitle = "ç‰›ä¹³ã‚’è²·ã„ã«è¡Œã";
    await titleTextbox.click();
    await page.keyboard.type(todoTitle);

    await page.getByRole("button", { name: "Add" }).click();

    // todo ãŒåæ˜ ã•ã‚Œã‚‹ã¾ã§å¾…ã¤
    // waitForResponse ã‚’ä½¿ã†ã¨å†…éƒ¨çŸ¥è­˜(APIã®URLã‚„APIã‚’å‘¼ã¶ã“ã¨)ã‚’çŸ¥ã£ã¦ã—ã¾ã†ãŸã‚é¿ã‘ãŸ
    await wait(
      async () =>
        (await page
          .getByRole("listitem")
          .filter({ hasText: todoTitle })
          .count()) === 0
    );

    // todo ãŒãƒªã‚¹ãƒˆã®æœ€å¾Œã«è¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(await page.getByRole("listitem").last().innerText()).toContain(
      todoTitle
    );

    // Todo è¿½åŠ å¾Œã«ã¯ã‚¿ã‚¤ãƒˆãƒ«ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ãŒç©ºã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(
      await page.getByRole("textbox", { name: "ToDoã‚¿ã‚¤ãƒˆãƒ«" }).inputValue()
    ).toBe("");
  });

  it("Todo ", async () => {
    const page = await createPage("/");

    // ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã® todo2 ã¯ isFinished ãŒ false ãªã®ã§ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„
    await page
      .getByRole("checkbox", {
        name: "todo2",
        checked: false,
      })
      .click();

    // ãƒã‚§ãƒƒã‚¯ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(
      await page
        .getByRole("checkbox", {
          name: "todo1",
          checked: true,
        })
        .isChecked()
    ).toBe(true);

    // Todo2 ã¯ isFinished ãŒ true ã«ãªã£ã¦ã„ã‚‹ã¯ãšãªã®ã§ãƒã‚§ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹
    await page
      .getByRole("checkbox", {
        name: "todo2",
        checked: true,
      })
      .click();

    // ãƒã‚§ãƒƒã‚¯ãŒå¤–ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª
    expect(
      await page
        .getByRole("checkbox", {
          name: "todo2",
          checked: false,
        })
        .isChecked()
    ).toBe(false);
  });
});
```

### ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```sh
yarn vitest
```

**NODE v18 ä»¥ä¸Šã®å ´åˆã¯ useFetch ã§ MSW ãŒãƒ¢ãƒƒã‚¯ã—ã¦ãã‚Œãªã„ã®ã§ NODE OPTIONS ã« --no-experimental-fetch ã‚’è¨­å®šã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚**

```sh
NODE_OPTIONS='--no-experimental-fetch' yarn vitest
```

è©³ã—ãã¯ã“ã¡ã‚‰ã®è¨˜äº‹ã«è¨˜è¼‰ã—ã¦ã„ã¾ã™ã€‚
https://zenn.dev/harusame0616/articles/d497a84a6cb792#node-18-%E4%BB%A5%E4%B8%8A%E3%81%A7-ssr-%E6%99%82%E3%81%AB-%24fetch-%E3%81%8C-mock-%E3%81%95%E3%82%8C%E3%81%AA%E3%81%84

## ã‚ã¨ãŒã

@nuxt/test-utils ã¯ã¾ã é–‹ç™ºä¸­ãªã®ã§ API ã‚„ä»•æ§˜ãŒå¤‰ã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ãŒã€ ãƒšãƒ¼ã‚¸å˜ä½ã®çµåˆãƒ†ã‚¹ãƒˆã‚’è©¦ã™ã“ã¨ãŒã§ãã¾ã—ãŸã€‚
ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç­‰ã‚‚ã¾ã æ•´å‚™ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€æœ¬ç•ªç’°å¢ƒã§ã¯ä¸å®‰ãŒæ®‹ã‚Šã¾ã™ãŒä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã«æœŸå¾…ã§ã™ã€‚
